{"version":3,"sources":["../src/vNode.js","../src/utils.js","../src/webDom.js","../src/const.js","../src/diff.js","../src/patch.js","index.js"],"names":["uid","VNode","name","props","children","patches","forOwn","obj","fn","Object","keys","forEach","key","isEmptyObject","length","groupProps","vNode","events","attributes","startsWith","eventName","slice","toLowerCase","eventHandler","push","WebDom","render","target","elm","document","createElement","prop","assign","style","className","setAttribute","handlers","handler","addEventListener","child","childNode","createTextNode","appendChild","diffType","REMOVE","PROPS","REPLACE","INSERT","TEXT","diffNode","oldNode","newNode","propsDiff","oldProps","newProps","filter","hasOwnProperty","oldStyle","newStyle","styleDiff","value","diffTree","oldTree","newTree","result","path","dfsDiff","tree1","tree2","rootPath","differenec","includes","children1","children2","maxChildCount","Math","max","i","patch","difference","Error","actions","dfs","node","diff","_path","map","p","action","modifier","parentNode","removeChild","replaceChild","textContent","ob","_action","removeProperty","removeAttribute","childNodes","handleClick","e","console","log","li","text","color","ul","onClick","getElementById","ul2","ul3","checkPatchInsert","querySelector","checkPatchDelete","btnInsert","btnRemove","btnRecover"],"mappings":"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","file":"example.e31bb0bc.map","sourceRoot":"../example","sourcesContent":["/**\n * 参数参照react的createElement\n * 主要是为了以后可能用jsx，毕竟我现在还不会编译原理\n */\n\nlet uid = 0\n\nfunction VNode(name, props, children) {\n  this.name = name\n  this.props = props || {}\n  this.children = children || []\n  this.uid = uid++\n  this.patches = []\n}\n\n\nexport default VNode","export const forOwn = (obj, fn) => {\n  Object.keys(obj).forEach(key => fn(key, obj[key]))\n}\n\nexport const isEmptyObject = obj => Object.keys(obj).length === 0\n\n// 分离attributes和events\nexport const groupProps = function(vNode) {\n  const props = vNode.props\n  const events = []\n  const attributes = []\n\n  Object.keys(props).forEach(key => {\n    if (key.startsWith('on')) {\n      const eventName = key.slice(2).toLowerCase()\n      const eventHandler = props[key]\n\n      if (events[eventName]) {\n        events[eventName].push(eventHandler)\n      } else {\n        events[eventName] = [eventHandler]\n      }\n    } else {\n      attributes[key] = props[key]\n    }\n  })\n\n  return {\n    events,\n    attributes,\n  }\n}\n","import { groupProps } from './utils'\nimport VNode from './vNode'\n\nconst WebDom = {}\n\nWebDom.render = function(vNode, target) {\n  const { name, children } = vNode\n  const { events, attributes } = groupProps(vNode)\n  const elm = document.createElement(name)\n\n  // 添加属性\n  Object.keys(attributes).forEach(key => {\n    const prop = attributes[key]\n\n    if (key === 'style') {\n      Object.assign(elm.style, prop)\n    } else if(key === 'className'){\n      elm.className = prop\n    } else {\n      elm.setAttribute(key, prop)\n    }\n  })\n\n  // 添加事件\n  Object.keys(events).forEach(eventName => {\n    const handlers = events[eventName]\n\n    handlers.forEach(handler => elm.addEventListener(eventName, handler))\n  })\n\n  // 渲染子节点\n  children.forEach(child => {\n    let childNode\n    if (child instanceof VNode) {\n      childNode = WebDom.render(child)\n    } else {\n      childNode = document.createTextNode(child)\n    }\n\n    elm.appendChild(childNode)\n  })\n\n  target && target.appendChild(elm)\n  return elm\n}\n\nexport default WebDom","const diffType = {\n  REMOVE: 1,\n  PROPS: 2,\n  REPLACE: 3,\n  INSERT: 4,\n  TEXT: 5,\n}\n\nexport default diffType","import diffType from './const'\nimport {\n  forOwn,\n  isEmptyObject,\n} from './utils'\n\nconst {\n  REMOVE,\n  REPLACE,\n  INSERT,\n  TEXT,\n  PROPS,\n} = diffType\n\n/**\n * diff 两个VNode之间的差异并返回，不递归diff子节点\n * @param {VNode} oldNode \n * @param {VNode} newNode \n */\nconst diffNode = (oldNode, newNode) => {\n  if (typeof oldNode === 'string' && typeof newNode === 'string'){\n    if (oldNode !== newNode) {\n      return [TEXT, newNode]\n    }\n    return false\n  }\n\n  if (oldNode.name !== newNode.name) {\n    return [REPLACE, newNode]\n  }\n\n  const propsDiff = {}\n\n  const oldProps = oldNode.props\n  const newProps = newNode.props\n\n  // 认为事件绑定函数不会改变\n  // 插入和修改prop\n  Object.keys(newProps)\n    .filter(prop => !prop.startsWith('on'))\n    .forEach(key => {\n      if (oldProps.hasOwnProperty(key)) {\n        // 对于style特殊处理\n        if (key === 'style') {\n          const oldStyle = oldProps.style\n          const newStyle = newProps.style\n          const styleDiff = {}\n\n          forOwn(newStyle, (key, value) => {\n            if (oldStyle.hasOwnProperty(key)) {\n              if (oldStyle[key] !== value) {\n                styleDiff[key] = [REPLACE, value]\n              }\n            } else {\n              styleDiff[key] = [INSERT, value]\n            }\n          })\n\n          forOwn(oldStyle, (key, value) => {\n            if (!newStyle.hasOwnProperty(key)) {\n              styleDiff[key] = [REMOVE]\n            }\n          })\n          \n          if (!isEmptyObject(styleDiff)) {\n            propsDiff.style = styleDiff\n          }\n        } else if(oldProps[key] !== newProps[key]) {\n          propsDiff[key] = [REPLACE, newProps[key]]\n        }\n      } else {\n        propsDiff[key] = [INSERT, newProps[key]]\n      }\n    })\n\n  // 删除prop\n  Object.keys(oldProps)\n    .filter(prop => !prop.startsWith('on'))\n    .forEach(key => {\n      if (!newProps.hasOwnProperty(key)) {\n        propsDiff[key] = [REMOVE]\n      }\n    })\n\n  if (Object.keys(propsDiff).length === 0) return false\n\n  return [PROPS, propsDiff]\n}\n\nconst diffTree = (oldTree, newTree) => {\n  const result = []\n  let path = 0\n\n  // 同步dfs两个树，需要注意保持同步\n  // 已经有过经验了，递归dfs快于手动堆栈\n  const dfsDiff = (tree1, tree2) => {\n    path++\n    const rootPath = path\n    const differenec = diffNode(tree1, tree2)\n    if (differenec) result.push([path, ...differenec])\n\n    const diffType = differenec[0]\n    // 如果是替换或者文本节点，不用递归往下\n    if ([REPLACE, TEXT].includes(diffType) || typeof tree1 === 'string') return\n\n    const children1 = [...tree1.children]\n    const children2 = [...tree2.children]\n    const maxChildCount = Math.max(children1.length, children2.length)\n    for(let i = 0; i < maxChildCount; i++) {\n      // 插入\n      if (i > children1.length - 1) {\n        // 注意插入这里要使用父节点的path\n        result.push([rootPath, INSERT, children2[i]])\n        continue\n      }\n      // 删除\n      if (i > children2.length - 1) {\n        path++\n        result.push([path, REMOVE, children1[i]])\n        continue\n      }\n\n      dfsDiff(children1[i], children2[i])\n    }\n  }\n\n  dfsDiff(oldTree, newTree)\n\n  return result\n}\n\nexport default diffTree","import diffType from './const'\nimport { forOwn } from './utils'\nimport WebDom from './webDom'\n\nconst {\n  REMOVE,\n  REPLACE,\n  INSERT,\n  TEXT,\n  PROPS,\n} = diffType\n\nconst patch = (difference = [], target) => {\n  if (!target) {\n    throw new Error('target is required')\n  }\n  let path = 0\n  const actions = []\n\n  const dfs = node => {\n    path++\n    const diff = difference.filter(([_path]) => path === _path).map(([p, action, modifier]) => [action, modifier])\n\n    diff.forEach(([action, modifier]) => {\n      if (action === REMOVE) {\n        node.parentNode.removeChild(node)\n      }\n\n      if (action === REPLACE) {\n        const newNode = WebDom.render(modifier)\n        node.parentNode.replaceChild(newNode, node)\n      }\n\n      if (action === TEXT) {\n        node.textContent = modifier\n      }\n\n      if (action === PROPS) {\n        Object.keys(modifier).forEach(prop => {\n          if (prop === 'style') {\n            forOwn(modifier[prop], (key, ob) => {\n              const [_action, value] = ob\n              if (_action === REMOVE) node.style.removeProperty(key)\n              if (_action === INSERT || _action === REPLACE) node.style[key] = value\n            })\n          } else {\n            const [_action, value] = modifier[prop]\n            if (_action === REMOVE) node.removeAttribute(prop)\n            if (_action === INSERT || _action === REPLACE) node.setAttribute(prop, value)\n          }\n        })\n      }\n\n      // 插入会影响后续的遍历，放入actions，遍历之后统一插入\n      if (action === INSERT) {\n        actions.push(() => node.appendChild(WebDom.render(modifier)))\n      }\n    })\n\n    // 插入，删除不用遍历子节点\n    if (diff[0] && [REPLACE, REMOVE].includes(diff[0][0])) {\n      return\n    }\n    node.childNodes.forEach(childNode => dfs(childNode))\n  }\n\n  dfs(target)\n  actions.forEach(action => action())\n}\n\nexport default patch","import VNode from '../src/vNode.js'\nimport WebDom from '../src/webDom.js'\nimport diff from '../src/diff.js'\nimport patch from '../src/patch.js'\n\nconst handleClick = (e) => {\n  console.log(e, 'clicked')\n}\n\nconst li = (text, color) => new VNode(\n  'li',\n  { style: { color }, },\n  [text]\n)\n\nconst ul = new VNode(\n  'ul',\n  { onClick: handleClick, className: 'container' },\n  [\n    li('列表项1', 'blue'),\n    li('列表项2', 'pink'),\n    li('列表项3', 'blueviolet'),\n  ]\n)\n\nWebDom.render(ul, document.getElementById('app'))\n\nconst ul2 = new VNode(\n  'ul',\n  { onClick: handleClick, className: 'container__' },\n  [\n    li('text', 'blue'),\n    new VNode('div', {}, ['replace']),\n    li('列表项3', 'red'),\n    li('insert', 'red'),\n  ]\n)\n\nconst ul3 = new VNode(\n  'ul',\n  { onClick: handleClick, className: 'container__' },\n  [\n    li('text', 'blueviolet'),\n    new VNode('div', {}, ['replace']),\n  ]\n)\n\nconst checkPatchInsert = () => {\n  const patches = diff(ul, ul2)\n  patch(patches, document.querySelector('.container'))\n}\n\nconst checkPatchDelete = () => {\n  const patches = diff(ul, ul3)\n  patch(patches, document.querySelector('.container'))\n}\n\nconst btnInsert = new VNode(\n  'button',\n  { onClick: checkPatchInsert },\n  ['Insert'],\n)\n\nconst btnRemove = new VNode(\n  'button',\n  { onClick: checkPatchDelete },\n  ['Remove'],\n)\n\nconst btnRecover = new VNode(\n  'button',\n  { onClick: () => WebDom.render(ul, document.getElementById('app')) },\n  ['Recover'],\n)\n\nWebDom.render(btnInsert, document.getElementById('btnwrap'))\nWebDom.render(btnRecover, document.getElementById('btnwrap'))\nWebDom.render(btnRemove, document.getElementById('btnwrap'))"]}